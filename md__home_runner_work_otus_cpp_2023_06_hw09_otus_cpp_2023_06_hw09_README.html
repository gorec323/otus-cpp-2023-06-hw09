<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>async_cli: OTUS C++ Developer. Professional HW-09</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">async_cli
   &#160;<span id="projectnumber">0.0.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Поиск','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OTUS C++ Developer. Professional HW-09 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Задание 9</h1>
<p>Основных целей две, нужно переработать код из задания про пакетную обработку команд (Задание 6) таким образом, чтобы:</p><ol type="1">
<li>команды обрабатывались многопоточно</li>
<li>ввод данных управлялся внешним кодом.</li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
1. Многопоточная обработка команд</h1>
<p>При старте программы должно быть создано в дополнение к существующему основному потоку ещё три дополнительных. Дадим им условные имена:</p><ul>
<li>main – основной поток (в пользовательском приложении)</li>
<li>log – поток для вывода данных в консоль</li>
<li>file1 – первый поток для вывода в файл</li>
<li>file2 – второй поток для вывода в файл Основная логика обработки меняется таким образом, что блок команд после своего формирования должен быть отправлен в консоль (потоком log) и сразу в файл (одним из потоков file1 или file2). При этом отправка блока в файл распределяется между файловыми потоками. Можно напрямую отправлять, например, чётные команды через поток file1, а нечётные – через file2. Но лучшим решение станет использование единой очереди команд, которую будут обрабатывать оба файловых потока одновременно. Следует обратить внимание на недостаточную точность часов для формирования уникального имени. Необходимо, сохранив timestamp в имени, добавить дополнительный постфикс, который будет гарантированно отличаться у файловых потоков.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
2. Управление вводом данных внешним кодом</h1>
<p>В рамках этой части работы нужно выполнить код в виде библиотеки с описанным в файле <a class="el" href="async_8h.html">async.h</a> внешним интерфейсом. Инициатором обмена будет выступать внешний код. Вместо привычной точки входа в приложение <a class="el" href="CMakeCXXCompilerId_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a> будут три внешних функции <a class="el" href="namespaceasync.html#a1ee32403d720599ebd484613a4243951" title="Создаётся контекст с передачей размера блока команд">connect()</a>, <a class="el" href="namespaceasync.html#ad7f05f529706a7089d3a54baa9369a49" title="Передача команды в рамках контекста, полученного вызовом команды connect.">receive()</a> и <a class="el" href="namespaceasync.html#a3687cc5bf5f4763651ee5c1db9a3d372" title="Завершение обработки команд">disconnect()</a>. Порядок вызовов следующий:</p><ul>
<li>вызывается <a class="el" href="namespaceasync.html#a1ee32403d720599ebd484613a4243951" title="Создаётся контекст с передачей размера блока команд">connect()</a> с передачей размера блока команд, сохраняется значение возврата. Значение никак не интерпретируется вызывающим кодом и служит только в качестве контекста для функций <a class="el" href="namespaceasync.html#ad7f05f529706a7089d3a54baa9369a49" title="Передача команды в рамках контекста, полученного вызовом команды connect.">receive()</a> и <a class="el" href="namespaceasync.html#a3687cc5bf5f4763651ee5c1db9a3d372" title="Завершение обработки команд">disconnect()</a>.</li>
<li>вызывается <a class="el" href="namespaceasync.html#ad7f05f529706a7089d3a54baa9369a49" title="Передача команды в рамках контекста, полученного вызовом команды connect.">receive()</a> c передачей указателя на начало буфера, его размера, а также контекста. Вызов повторяемый – вызывающий код может использовать его для передачи нескольких команд подряд.</li>
<li>вызывается <a class="el" href="namespaceasync.html#a3687cc5bf5f4763651ee5c1db9a3d372" title="Завершение обработки команд">disconnect()</a> с передачей контекста. Вызов разрушает контекст полностью. С точки зрения логики обработки команд этот вызов считается завершением текущего блока команд.</li>
</ul>
<p>Необходимо реализовать эти функции так, чтобы сохранить прежнюю функционально проекта. Реализация должна допускать множественные вызовы <a class="el" href="namespaceasync.html#a1ee32403d720599ebd484613a4243951" title="Создаётся контекст с передачей размера блока команд">connect()</a>. Вызовы <a class="el" href="namespaceasync.html#ad7f05f529706a7089d3a54baa9369a49" title="Передача команды в рамках контекста, полученного вызовом команды connect.">receive()</a> с разными контекстами не должны мешать друг другу. Вызовы могут осуществляться из разных потоков, однако вызовы с одинаковым контекстом всегда выполняются из одного и того же потока. Опционально реализовать возможность вызывать все функции из любых потоков.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Требования к реализации</h2>
<p>Результатом работы должна стать библиотека, устанавливаемая по стандартному пути. Библиотека должна называться libasync.so и находиться в пакете async. Для проверки работоспособности следует реализовать также исполняемый файл, который использует библиотеку с демонстрацией всех вызовов. Исполняемый файл также должен быть добавлен в пакет.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Проверка</h2>
<p>Задание считается выполненным успешно, если после установки пакета, линковки с тестовым кодом (пример в main.cpp) и запуска с тестовыми данными вывод соответствует описанию Задания</p><ol type="1">
<li>Данные подаются порциями в разных контекстах в большом объёме без пауз. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Создано системой&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
